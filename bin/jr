#!/usr/bin/env python3

import os
from functools import partial

import requests


class Jira:
    def __init__(self, url, token):
        self.url = url
        self.token = token

    def __getattr__(self, name):
        return partial(call_jira_api, self.url, self.token, name)


def call_jira_api(url, token, method, jql):
    headers = {"Authorization": f"Bearer {token}"}
    params = {'jql': jql}
    resp = requests.get(f'{url}rest/api/latest/{method}', headers=headers, params=params)
    return resp.json()


if __name__ == '__main__':
    url = os.environ["JIRA_URL"]
    token = os.environ["JIRA_TOKEN"]
    j = Jira(url, token)
    result = j.search('assignee=kdevens')
    keys = [v["key"] for v in result['issues']]
    print(keys)
